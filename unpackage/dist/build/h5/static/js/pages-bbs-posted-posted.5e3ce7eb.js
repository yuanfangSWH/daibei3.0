(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-bbs-posted-posted"],{"0128":function(t,e,a){"use strict";var i=a("ee27");a("99af"),a("a9e3"),a("d3b7"),a("ac1f"),a("25f0"),a("3ca3"),a("1276"),a("ddb0"),a("2b3d"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("0472")),s=i(a("8541")),o=(a("1747"),{components:{robbyImageUpload:s.default},data:function(){return{limitNumber:9,imageData:[],imageStr:"",imageStr2:"",imageStr3:"",isAct:!1,textContent:"",sqTitle:"",bbsTags:"",tagIds:1,tabcurrent:0,isshow:!1,imglength:0,kai:!1}},onLoad:function(){this.tagFun()},computed:{},methods:{tagFun:function(){var t=this;n.default.apiPost("/forum/tags","","","GET",(function(e,a,i){if(0==a.code){t.bbsTags=a.data;for(var n=[],s=0;s<t.bbsTags.length;s++){var o=t.bbsTags[s].id;n=n.concat(o)}t.tagIds=n[0]}else uni.showToast({title:"数据加载失败",icon:"none"})}))},tagclick:function(t,e){this.tagIds=t,this.tabcurrent=e},dfclick:function(t,e){this.isshow=!0,this.tagIds=t,this.tabcurrent=e,this.hasCon()},addImg:function(t){this.imageData=t.allImages,this.imglength=this.imageData.length,this.hasCon(),this.imageStr=t.currentImages.toString();var e=this;if(e.kai=!0,e.imageStr3="",1==e.kai){e.kai=!1;for(var a=0;a<e.imageData.length;a++){window.URL=window.URL||window.webkitURL;var i=new XMLHttpRequest;i.open("get",e.imageData[a],!0),i.responseType="blob",i.onload=function(){if(200==this.status){var t=this.response,a=new FileReader;a.onloadend=function(a){if(t.size>1048576){var i=new Image;i.src=a.target.result,i.onload=function(){var t=document.createElement("canvas"),a=t.getContext("2d"),n=i.width/2,s=i.height/2,o="";t.width=n,t.height=s,a.drawImage(i,0,0,n,s),o=t.toDataURL("image/jpeg"),e.imageStr2=o+"|",e.imageStr3=e.imageStr3+e.imageStr2}}else e.imageStr2=a.target.result+"|",e.imageStr3=e.imageStr3+e.imageStr2},a.readAsDataURL(t)}},i.send()}}},hasCon:function(){""==this.textContent||""==this.sqTitle||0==this.isshow?this.isAct=!1:this.isAct=!0},fabuFun:function(){""==this.imageData&&(this.imageStr3="");var t=this.imageStr3;1==this.imglength&&(this.imageStr3=t.substring(0,t.length-1));for(var e=this.imageStr3.split("data:"),a="",i=1;i<=this.imglength;i++){var s="data:"+e[i];a+=s}this.imageStr3=a;var o="",r="";""==this.imageStr3?(o={title:this.sqTitle,content:this.textContent,tag:Number(this.tagIds)},r="?title="+this.sqTitle+"&content="+this.textContent+"&tag="+this.tagIds):(o={title:this.sqTitle,content:this.textContent,tag:Number(this.tagIds),img:this.imageStr3},r="?title="+this.sqTitle+"&content="+this.textContent+"&tag="+this.tagIds+"&img="+this.imageStr3),1==this.isAct&&(uni.showLoading({title:"发布中"}),n.default.apiPost("/forum/send",r,o,"POST",(function(t,e,a){0==e.code?(uni.showToast({title:"发布成功！",icon:"success",duration:2e3,success:function(){uni.switchTab({url:"/pages/bbs/bbs"})}}),uni.hideLoading()):(uni.showToast({title:""+e.msg,icon:"none"}),uni.hideLoading())})))}}});e.default=o},"037a":function(t,e,a){"use strict";var i=a("ed55"),n=a.n(i);n.a},1747:function(t,e,a){"use strict";function i(t){if(0===t.indexOf("_www")||0===t.indexOf("_doc")||0===t.indexOf("_documents")||0===t.indexOf("_downloads"))return t;if(0===t.indexOf("file://"))return t;if(0===t.indexOf("/storage/emulated/0/"))return t;if(0===t.indexOf("/")){var e=plus.io.convertAbsoluteFileSystem(t);if(e!==t)return e;t=t.substr(1)}return"_www/"+t}function n(t){return new Promise((function(e,a){if("object"===typeof window&&"document"in window){var n=document.createElement("canvas"),s=n.getContext("2d"),o=new Image;return o.onload=function(){n.width=o.width,n.height=o.height,s.drawImage(o,0,0),e(n.toDataURL())},o.onerror=a,void(o.src=t)}"object"!==typeof plus?"object"===typeof wx&&wx.canIUse("getFileSystemManager")?wx.getFileSystemManager().readFile({filePath:t,encoding:"base64",success:function(t){e("data:image/png;base64,"+t.data)},fail:function(t){a(t)}}):a(new Error("not support")):plus.io.resolveLocalFileSystemURL(i(t),(function(t){t.file((function(t){var i=new plus.io.FileReader;i.onload=function(t){e(t.target.result)},i.onerror=function(t){a(t)},i.readAsDataURL(t)}),(function(t){a(t)}))}),(function(t){a(t)}))}))}function s(t){return new Promise((function(e,a){if("object"===typeof window&&"document"in window){t=t.split(",");var i=t[0].match(/:(.*?);/)[1],n=atob(t[1]),s=n.length,o=new Uint8Array(s);while(s--)o[s]=n.charCodeAt(s);return e((window.URL||window.webkitURL).createObjectURL(new Blob([o],{type:i})))}var r=t.match(/data\:\S+\/(\S+);/);r?r=r[1]:a(new Error("base64 error"));var l=Date.now()+"."+r;if("object"!==typeof plus)if("object"===typeof wx&&wx.canIUse("getFileSystemManager")){var d=wx.env.USER_DATA_PATH+"/"+l;wx.getFileSystemManager().writeFile({filePath:d,data:t.replace(/^data:\S+\/\S+;base64,/,""),encoding:"base64",success:function(){e(d)},fail:function(t){a(t)}})}else a(new Error("not support"));else{var c=new plus.nativeObj.Bitmap("bitmap"+Date.now());c.loadBase64Data(t,(function(){var t="_doc/uniapp_temp/"+l;c.save(t,{},(function(){c.clear(),e(t)}),(function(t){c.clear(),a(t)}))}),(function(t){c.clear(),a(t)}))}}))}a("c975"),a("ace4"),a("d3b7"),a("ac1f"),a("3ca3"),a("466d"),a("5319"),a("1276"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("ddb0"),a("2b3d"),Object.defineProperty(e,"__esModule",{value:!0}),e.pathToBase64=n,e.base64ToPath=s},4882:function(t,e,a){"use strict";var i,n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"imageUploadContainer"},[a("v-uni-view",{staticClass:"imageUploadList"},[t._l(t.imageList,(function(e,i){return a("v-uni-view",{key:i,staticClass:"imageItem"},[a("v-uni-image",{class:{dragging:t.isDragging(i)},attrs:{src:e,draggable:"true","data-index":i},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.start.apply(void 0,arguments)},touchmove:function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.move.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.stop.apply(void 0,arguments)},click:function(e){arguments[0]=e=t.$handleEvent(e),t.previewImage.apply(void 0,arguments)}}}),t.isShowDel?a("v-uni-view",{staticClass:"imageDel",attrs:{"data-index":i},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteImage.apply(void 0,arguments)}}},[t._v("x")]):t._e()],1)})),t.isShowAdd?a("v-uni-view",{staticClass:"imageUpload",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectImage.apply(void 0,arguments)}}},[t._v("+")]):t._e()],2),t.showMoveImage?a("v-uni-image",{staticClass:"moveImage",style:{left:t.posMoveImageLeft,top:t.posMoveImageTop},attrs:{src:t.moveImagePath}}):t._e()],1)},s=[];a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return i}))},"4e63":function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,".imageUploadContainer[data-v-988c841c]{padding:%?10?% %?5?%;margin:%?10?% %?5?%}.dragging[data-v-988c841c]{-webkit-transform:scale(1.2);transform:scale(1.2)}.imageUploadList[data-v-988c841c]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-wrap:wrap;flex-wrap:wrap}.imageItem[data-v-988c841c]{position:relative}.imageItem[data-v-988c841c], .imageUpload[data-v-988c841c]{width:%?216?%;height:%?216?%;margin:0 %?10?% %?10?% 0}.imageDel[data-v-988c841c]{position:absolute;right:%?10?%;top:%?10?%;background-color:rgba(0,0,0,.5);width:%?36?%;text-align:center;line-height:%?35?%;border-radius:%?17?%;color:#fff;font-size:%?30?%;padding-bottom:%?2?%}.imageItem uni-image[data-v-988c841c], .moveImage[data-v-988c841c]{width:%?216?%;height:%?216?%}.imageUpload[data-v-988c841c]{line-height:%?180?%;text-align:center;font-size:%?148?%;font-family:PingFang-SC-Medium;color:#d9d9d9;border:%?4?% dashed #d9d9d9;box-sizing:border-box}.moveImage[data-v-988c841c]{position:absolute}",""]),t.exports=e},"4f87":function(t,e,a){"use strict";var i;a("a434"),a("d3b7"),a("3ca3"),a("ddb0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={name:"robby-image-upload",props:["value","enableDel","enableAdd","enableDrag","serverUrl","formData","limit","fileKeyName","showUploadProgress","serverUrlDeleteImage"],data:function(){return{imageBasePos:{x0:-1,y0:-1,w:-1,h:-1},showMoveImage:!1,moveImagePath:"",moveLeft:0,moveTop:0,deltaLeft:0,deltaTop:0,dragIndex:null,targetImageIndex:null,imageList:[]}},onLoad:function(){this.imageList=this.value},computed:{posMoveImageLeft:function(){return this.moveLeft+"px"},posMoveImageTop:function(){return this.moveTop+"px"},isShowDel:function(){return!1!==this.enableDel},isShowAdd:function(){return!1!==this.enableAdd&&!(this.limit&&this.imageList.length>=this.limit)},isDragable:function(){return!1!==this.enableDrag}},methods:{selectImage:function(){i=this,i.imageList||(i.imageList=[]),uni.chooseImage({count:i.limit?i.limit-i.imageList.length:999,success:function(t){var e=t.tempFilePaths;if(i.limit){var a=i.limit-i.imageList.length;if(a<e.length)return void uni.showToast({title:"图片总数限制为"+i.limit+"张，当前还可以选"+a+"张",icon:"none",mask:!1,duration:2e3})}for(var n=0;n<e.length;n++)i.imageList.push(e[n]);if(i.serverUrl){for(var s=i.imageList.length-e.length,o=[],r=i.fileKeyName?i.fileKeyName:"upload-images",l=0,d=function(t){o.push(new Promise((function(a,n){var o=s+t;uni.uploadFile({url:i.serverUrl,fileType:"image",formData:i.formData,filePath:e[t],name:r,success:function(t){200===t.statusCode?(i.imageList[o]=t.data,l++,i.showUploadProgress&&uni.showToast({title:"上传进度："+l+"/"+e.length,icon:"none",mask:!1,duration:1e3}),console.log("success to upload image: "+t.data),a("success to upload image:"+o)):(console.log("fail to upload image:"+t.data),n("failt to upload image:"+o))},fail:function(t){console.log("fail to upload image:"+t),n("failt to upload image:"+o)}})})))},c=0;c<e.length;c++)d(c);Promise.all(o).then((function(t){i.$emit("add",{currentImages:e,allImages:i.imageList}),i.$emit("input",i.imageList)}))}else i.$emit("add",{currentImages:e,allImages:i.imageList}),i.$emit("input",i.imageList)}})},deleteImage:function(t){var e=t.currentTarget.dataset.index,a=this.imageList[e];this.imageList.splice(e,1),this.serverUrlDeleteImage&&uni.request({url:this.serverUrlDeleteImage,method:"GET",data:{imagePath:a},success:function(t){console.log(t.data)}}),this.$emit("delete",{currentImage:a,allImages:this.imageList}),this.$emit("input",this.imageList)},previewImage:function(t){var e=t.currentTarget.dataset.index;uni.previewImage({current:this.imageList[e],indicator:"number",loop:"true",urls:this.imageList})},initImageBasePos:function(){var t=.024;i=this,uni.getSystemInfo({success:function(e){var a=e.screenWidth,n=Math.ceil(t*a),s=Math.ceil((a-2*n)/4);i.imageBasePos.x0=n,i.imageBasePos.w=s,i.imageBasePos.h=s}})},findOverlapImage:function(t,e){var a=Math.floor((t-this.imageBasePos.x0)/this.imageBasePos.w),i=Math.floor((e-this.imageBasePos.y0)/this.imageBasePos.h),n=4*i+a;return n},isDragging:function(t){return this.dragIndex===t},start:function(t){if(console.log(this.isDragable),this.isDragable){if(this.dragIndex=t.currentTarget.dataset.index,this.moveImagePath=this.imageList[this.dragIndex],this.showMoveImage=!0,-1===this.imageBasePos.y0){this.initImageBasePos();var e=Math.floor(this.dragIndex/4)*this.imageBasePos.h,a=t.currentTarget.offsetTop;this.imageBasePos.y0=a-e}this.moveLeft=t.target.offsetLeft,this.moveTop=t.target.offsetTop}},move:function(t){if(this.isDragable){var e=t.touches[0];this.targetImageIndex=this.findOverlapImage(e.clientX,e.clientY),0===this.deltaLeft&&(this.deltaLeft=e.clientX-this.moveLeft,this.deltaTop=e.clientY-this.moveTop),this.moveLeft=e.clientX-this.deltaLeft,this.moveTop=e.clientY-this.deltaTop}},stop:function(t){this.isDragable&&(null!==this.dragIndex&&null!==this.targetImageIndex&&(this.targetImageIndex<0&&(this.targetImageIndex=0),this.targetImageIndex>=this.imageList.length&&(this.targetImageIndex=this.imageList.length-1),this.dragIndex!==this.targetImageIndex&&(this.imageList[this.dragIndex]=this.imageList[this.targetImageIndex],this.imageList[this.targetImageIndex]=this.moveImagePath)),this.dragIndex=null,this.targetImageIndex=null,this.deltaLeft=0,this.deltaTop=0,this.showMoveImage=!1,this.$emit("input",this.imageList))}}};e.default=n},"7d1e":function(t,e,a){"use strict";a.r(e);var i=a("4f87"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},"7de5":function(t,e,a){var i=a("ae31");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("d1247ff4",i,!0,{sourceMap:!1,shadowMode:!1})},8541:function(t,e,a){"use strict";a.r(e);var i=a("4882"),n=a("7d1e");for(var s in n)"default"!==s&&function(t){a.d(e,t,(function(){return n[t]}))}(s);a("037a");var o,r=a("f0c5"),l=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"988c841c",null,!1,i["a"],o);e["default"]=l.exports},"9fa1":function(t,e,a){"use strict";var i=a("7de5"),n=a.n(i);n.a},ae31:function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,".ftBox[data-v-233a8908] .uni-input-placeholder{color:#c6c9cd}.ftipt[data-v-233a8908]{border-bottom:1px solid #e4e7ea;padding:%?20?% %?26?%;font-size:%?30?%}.ftBox[data-v-233a8908]{width:%?750?%}.ftmain[data-v-233a8908]{width:%?698?%;margin:%?26?% %?26?% 0;padding-bottom:%?208?%}.ftCon[data-v-233a8908]{width:%?698?%;padding:0 0 %?20?%;font-size:%?28?%;line-height:%?48?%;min-height:%?200?%}.ft-add[data-v-233a8908]{width:100%;margin-top:%?30?%;display:inline-block}.addimg[data-v-233a8908]{width:%?218?%;height:%?218?%}.ftTip[data-v-233a8908]{color:#a0a2a5;font-size:%?22?%;font-family:PingFang-SC-Medium;margin-top:%?20?%;line-height:%?42?%}.ftBtn[data-v-233a8908]{position:fixed;left:0;bottom:0;display:-webkit-box;display:-webkit-flex;display:flex;width:%?750?%}.fabuBtn[data-v-233a8908]{-webkit-box-flex:1;-webkit-flex:1;flex:1;border:none!important;background:#ccc;color:#fff;font-size:%?34?%;font-family:PingFang-SC-Medium;border-radius:0!important}.fabuBtn[data-v-233a8908]:after{border:none!important;border-radius:%?0?%!important}.active01[data-v-233a8908]{background:#257bff!important}.bqtitle[data-v-233a8908]{font-size:%?26?%;font-family:PingFang SC;color:#a0a2a5;margin-top:%?30?%}.bqbox[data-v-233a8908]{width:%?698?%;float:left;margin-top:%?20?%}.bq-c[data-v-233a8908]{float:left;height:%?58?%;line-height:%?58?%;background:#d7d7d7;border-radius:%?29?%;color:#fff;font-size:%?26?%;padding:0 %?30?%;margin-right:%?20?%}.tactive[data-v-233a8908]{background:#257bff!important}",""]),t.exports=e},b113:function(t,e,a){"use strict";var i={robbyImageUpload:a("8541").default},n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"ftBox"},[a("v-uni-input",{staticClass:"ftipt",attrs:{type:"text",placeholder:"想个标题吧",value:""},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.hasCon.apply(void 0,arguments)}},model:{value:t.sqTitle,callback:function(e){t.sqTitle=e},expression:"sqTitle"}}),a("v-uni-view",{staticClass:"ftmain"},[a("v-uni-textarea",{staticClass:"ftCon",attrs:{"auto-height":!0,placeholder:"想跟老铁们说点什么？就尽情发挥吧。","placeholder-style":"color:#C6C9CD"},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.hasCon.apply(void 0,arguments)}},model:{value:t.textContent,callback:function(e){t.textContent=e},expression:"textContent"}}),a("v-uni-view",{staticClass:"ftNav01"},[a("v-uni-view",{staticClass:"ft-add"},[a("robby-image-upload",{attrs:{limit:t.limitNumber},on:{add:function(e){arguments[0]=e=t.$handleEvent(e),t.addImg.apply(void 0,arguments)}},model:{value:t.imageData,callback:function(e){t.imageData=e},expression:"imageData"}})],1),a("v-uni-view",{staticClass:"ftTip"},[t._v("提示：单张图片限制1M以内，最多9张。发布后显示的图片为压缩处理过后的图片。帖子发布需审核，通过后才显示。禁止发布任何广告内容，严重者封号处理。")]),a("v-uni-view",{staticClass:"bqtitle"},[t._v("请选择分类标签：")]),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:!t.isshow,expression:"!isshow"}],staticClass:"bqbox"},t._l(t.bbsTags,(function(e,i){return a("v-uni-view",{key:i,staticClass:"bq-c",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.dfclick(e.id,i)}}},[t._v(t._s(e.tab_name))])})),1),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.isshow,expression:"isshow"}],staticClass:"bqbox"},t._l(t.bbsTags,(function(e,i){return a("v-uni-view",{key:e.id,staticClass:"bq-c",class:{tactive:i==t.tabcurrent},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.tagclick(e.id,i)}}},[t._v(t._s(e.tab_name))])})),1)],1)],1),a("v-uni-view",{staticClass:"ftBtn"},[a("v-uni-button",{staticClass:"fabuBtn",class:{active01:1==t.isAct},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.fabuFun.apply(void 0,arguments)}}},[t._v("发布")])],1)],1)},s=[];a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return s})),a.d(e,"a",(function(){return i}))},e489:function(t,e,a){"use strict";a.r(e);var i=a("b113"),n=a("e974");for(var s in n)"default"!==s&&function(t){a.d(e,t,(function(){return n[t]}))}(s);a("9fa1");var o,r=a("f0c5"),l=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"233a8908",null,!1,i["a"],o);e["default"]=l.exports},e974:function(t,e,a){"use strict";a.r(e);var i=a("0128"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},ed55:function(t,e,a){var i=a("4e63");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("7b1f0e68",i,!0,{sourceMap:!1,shadowMode:!1})}}]);